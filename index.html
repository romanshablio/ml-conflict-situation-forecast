<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ü—Ä–æ–≥–Ω–æ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      --bg: #f5f5f7;
      --bg-card: #ffffff;
      --border: #d0d0d7;
      --accent: #3f73ff;
      --accent-soft: #e3ebff;
      --danger: #ff4d4f;
      --text-main: #222;
      --text-muted: #666;
      --shadow-soft: 0 8px 20px rgba(0, 0, 0, 0.05);
      --radius-lg: 14px;
      --radius-md: 10px;
      --radius-sm: 6px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text-main);
    }

    .app-shell {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      background: #ffffff;
      border-bottom: 1px solid var(--border);
      box-shadow: var(--shadow-soft);
      position: sticky;
      top: 0;
      z-index: 20;
    }

    .header-inner {
      max-width: 1120px;
      margin: 0 auto;
      padding: 12px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }

    .logo-block {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-icon {
      width: 32px;
      height: 32px;
      border-radius: 10px;
      background: linear-gradient(135deg, #3f73ff, #8b5cf6);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-weight: 700;
      font-size: 18px;
      box-shadow: 0 6px 16px rgba(63, 115, 255, 0.35);
    }

    .logo-text-main {
      font-weight: 600;
      font-size: 15px;
    }

    .logo-text-sub {
      font-size: 12px;
      color: var(--text-muted);
    }

    nav {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .nav-btn {
      border: none;
      background: transparent;
      padding: 8px 14px;
      border-radius: 999px;
      font-size: 13px;
      cursor: pointer;
      color: var(--text-muted);
      transition: background 0.18s ease, color 0.18s ease, box-shadow 0.18s ease;
    }

    .nav-btn:hover {
      background: #f1f3ff;
      color: var(--accent);
    }

    .nav-btn.active {
      background: var(--accent);
      color: #fff;
      box-shadow: 0 6px 16px rgba(63, 115, 255, 0.4);
    }

    main {
      flex: 1;
    }

    .page {
      max-width: 1120px;
      margin: 20px auto 40px;
      padding: 0 20px;
    }

    .section {
      display: none;
      animation: fadeIn 0.25s ease-out;
    }

    .section.active {
      display: block;
    }

    .section-title {
      font-size: 22px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .section-subtitle {
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 20px;
    }

    .layout-two-column {
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2fr);
      gap: 20px;
    }

    @media (max-width: 900px) {
      .layout-two-column {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-soft);
      padding: 18px 18px 16px;
      border: 1px solid rgba(0, 0, 0, 0.03);
    }

    .card-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      margin-bottom: 8px;
      gap: 10px;
    }

    .card-title {
      font-size: 15px;
      font-weight: 600;
    }

    .card-subtitle {
      font-size: 12px;
      color: var(--text-muted);
    }

    label {
      font-size: 13px;
      font-weight: 500;
      margin-bottom: 4px;
      display: inline-block;
    }

    .field-hint {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    textarea,
    input[type="text"],
    input[type="number"],
    input[type="file"],
    select {
      width: 100%;
      font-size: 13px;
      padding: 8px 10px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      outline: none;
      background: #fff;
      transition: border 0.15s ease, box-shadow 0.15s ease;
    }

    textarea {
      min-height: 140px;
      resize: vertical;
    }

    textarea:focus,
    input:focus,
    select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px var(--accent-soft);
    }

    .field-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 10px;
    }

    .field-row > div {
      flex: 1 1 160px;
    }

    .btn-primary,
    .btn-secondary,
    .btn-ghost {
      font-size: 13px;
      padding: 8px 16px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      transition: background 0.15s ease, box-shadow 0.15s ease, transform 0.05s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-primary {
      background: var(--accent);
      color: #fff;
      box-shadow: 0 6px 16px rgba(63, 115, 255, 0.4);
    }

    .btn-primary:hover {
      background: #335ee6;
    }

    .btn-secondary {
      background: var(--accent-soft);
      color: var(--accent);
    }

    .btn-secondary:hover {
      background: #d9e2ff;
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-muted);
    }

    .btn-ghost:hover {
      background: #f0f0f3;
    }

    .btn-primary:active,
    .btn-secondary:active,
    .btn-ghost:active {
      transform: translateY(1px);
      box-shadow: none;
    }

    .results-block {
      font-size: 13px;
      border-radius: var(--radius-md);
      border: 1px dashed var(--border);
      padding: 12px 12px 10px;
      background: #fafbff;
    }

    .results-header {
      display: flex;
      justify-content: space-between;
      gap: 6px;
      margin-bottom: 8px;
      align-items: center;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
    }

    .pill-risk-low {
      background: #e5f8e8;
      color: #218838;
    }

    .pill-risk-medium {
      background: #fff5d6;
      color: #996c00;
    }

    .pill-risk-high {
      background: #ffe5e5;
      color: #d93025;
    }

    .pill-model {
      background: #eef0ff;
      color: #3949ab;
    }

    .muted {
      color: var(--text-muted);
      font-size: 12px;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      border-radius: 999px;
      background: #ececf3;
      overflow: hidden;
      margin-top: 6px;
    }

    .progress-bar-inner {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #3f73ff, #8b5cf6);
      transition: width 0.3s ease;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }

    th,
    td {
      padding: 6px 8px;
      border-bottom: 1px solid #ececf3;
      text-align: left;
      white-space: nowrap;
    }

    th {
      font-weight: 600;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.03em;
      color: var(--text-muted);
    }

    tr:hover td {
      background: #fafbff;
    }

    .tag {
      display: inline-flex;
      padding: 1px 6px;
      border-radius: 999px;
      background: #eef0ff;
      font-size: 11px;
      color: #3949ab;
    }

    footer {
      text-align: center;
      font-size: 11px;
      color: var(--text-muted);
      padding: 16px 0 22px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      background: #f1f3ff;
      color: #3949ab;
    }

    .checkbox-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      font-size: 12px;
      margin-top: 8px;
    }

    .checkbox-row label {
      font-weight: 400;
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 0;
    }

    .checkbox-row input[type="checkbox"] {
      width: auto;
    }

    .filters-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 10px;
      align-items: flex-end;
    }

    .filters-row > div {
      flex: 1 1 140px;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 4px;
    }

    .status-dot-online {
      background: #22c55e;
    }

    .status-dot-busy {
      background: #facc15;
    }

    .status-dot-offline {
      background: #9ca3af;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(4px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    img {
      width: 50px;
      height: 50px;
    }
  </style>
</head>
<body>
<div class="app-shell">

  <!-- HEADER -->
  <header>
    <div class="header-inner">
      <div class="logo-block">
        <img src="/static/img/logo.png" alt="–õ–æ–≥–æ—Ç–∏–ø">
        <div>
          <div class="logo-text-main">–ü—Ä–æ–≥–Ω–æ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π</div>
          <div class="logo-text-sub">–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π</div>
        </div>
      </div>

      <nav>
        <button class="nav-btn active" data-section="quick">–ë—ã—Å—Ç—Ä—ã–π –∞–Ω–∞–ª–∏–∑</button>
        <button class="nav-btn" data-section="batch">–ü–∞–∫–µ—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑</button>
        <button class="nav-btn" data-section="history">–ò—Å—Ç–æ—Ä–∏—è –∏ –æ—Ç—á—ë—Ç—ã</button>
        <button class="nav-btn" data-section="train">–û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏</button>
      </nav>
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main>
    <div class="page">

      <!-- SECTION: QUICK ANALYSIS -->
      <section id="section-quick" class="section active">
        <h1 class="section-title">–ë—ã—Å—Ç—Ä—ã–π –∞–Ω–∞–ª–∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è</h1>
        <p class="section-subtitle">
          –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è, –≤—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å –∏ –ø–æ–ª—É—á–∏—Ç–µ –æ—Ü–µ–Ω–∫—É –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏.
        </p>

        <div class="layout-two-column">

          <!-- LEFT: INPUT -->
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è</div>
                <div class="card-subtitle">–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±—É—á–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏ –Ω–∞ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –¥–∞–Ω–Ω—ã—Ö</div>
              </div>
              <span class="badge">
                <span class="status-dot status-dot-online"></span>
                –ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞ (–¥–µ–º–æ)
              </span>
            </div>

            <label for="quick-text">–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è</label>
            <p class="field-hint">
              –ù–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∏–∑ —á–∞—Ç–∞, —Ñ–æ—Ä—É–º–∞, —Å–æ—Ü—Å–µ—Ç–∏ –∏–ª–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å–∏—Å—Ç–µ–º—ã.
            </p>
            <textarea id="quick-text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≥–µ–Ω–Ω–æ—Å—Ç—å..."></textarea>

            <div class="field-row">
              <div>
                <label for="quick-model">–ú–æ–¥–µ–ª—å –∞–Ω–∞–ª–∏–∑–∞</label>
                <select id="quick-model">
                  <option value="ml">–ë–∞–∑–æ–≤–∞—è ML-–º–æ–¥–µ–ª—å (–≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π –±—É—Å—Ç–∏–Ω–≥)</option>
                  <option value="dl" selected>DL-–º–æ–¥–µ–ª—å (LSTM / GRU)</option>
                </select>
              </div>
              <div>
                <label for="quick-threshold">–ü–æ—Ä–æ–≥ —Ä–∏—Å–∫–∞ (0‚Äì1)</label>
                <input id="quick-threshold" type="number" min="0" max="1" step="0.01" value="0.7">
              </div>
            </div>

            <div style="margin-top:14px; display:flex; gap:8px; flex-wrap:wrap;">
              <button class="btn-primary" id="quick-analyze-btn">
                ‚ñ∂ –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
              </button>
              <button class="btn-ghost" id="quick-clear-btn">
                –û—á–∏—Å—Ç–∏—Ç—å —Ç–µ–∫—Å—Ç
              </button>
            </div>
          </div>

          <!-- RIGHT: RESULTS -->
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞</div>
                <div class="card-subtitle">–ó–¥–µ—Å—å –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∏ —É—Ä–æ–≤–Ω–∏ —Ä–∏—Å–∫–∞</div>
              </div>
            </div>

            <div class="results-block" id="quick-results">
              <div class="muted">
                –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∫–∞ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã. –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–ª–µ–≤–∞ –∏ –Ω–∞–∂–º–∏—Ç–µ
                ¬´–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ¬ª.
              </div>
            </div>

            <div style="margin-top:12px; display:flex; justify-content:space-between; gap:8px; flex-wrap:wrap;">
              <button class="btn-secondary" id="quick-save-history-btn" disabled>
                üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∏—Å—Ç–æ—Ä–∏—é
              </button>
             
            </div>
          </div>
        </div>
      </section>

      <!-- SECTION: BATCH ANALYSIS -->
      <section id="section-batch" class="section">
        <h1 class="section-title">–ü–∞–∫–µ—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å–æ–æ–±—â–µ–Ω–∏–π</h1>
        <p class="section-subtitle">
          –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª —Å –Ω–∞–±–æ—Ä–æ–º —Å–æ–æ–±—â–µ–Ω–∏–π (CSV/TXT), –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–∞–∫–µ—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏ –ø–æ–ª—É—á–∏—Ç–µ
          —Å–≤–æ–¥–∫—É –ø–æ —É—Ä–æ–≤–Ω—è–º —Ä–∏—Å–∫–∞.
        </p>

        <div class="layout-two-column">
          <!-- LEFT: FORM -->
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö</div>
                <div class="card-subtitle">–§–∞–π–ª —Å —Ç–µ–∫—Å—Ç–∞–º–∏ —Å–æ–æ–±—â–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—ã–≥—Ä—É–∑–∫–∞ –∏–∑ —Å–∏—Å—Ç–µ–º—ã)</div>
              </div>
            </div>

            <label for="batch-file">–§–∞–π–ª —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ (CSV –∏–ª–∏ TXT, –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ = –æ–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ)</label>
            <input type="file" id="batch-file" accept=".csv,.txt">

            <div class="field-row" style="margin-top:12px;">
              <div>
                <label for="batch-column">–°—Ç–æ–ª–±–µ—Ü —Å —Ç–µ–∫—Å—Ç–æ–º —Å–æ–æ–±—â–µ–Ω–∏–π</label>
                <select id="batch-column">
                  <option value="">‚Äî –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞ —Ñ–∞–π–ª–∞ (–¥–µ–º–æ) ‚Äî</option>
                  <option value="comment_text">comment_text</option>
                  <option value="text">text</option>
                </select>
              </div>
              <div>
                <label for="batch-threshold">–ü–æ—Ä–æ–≥ —Ä–∏—Å–∫–∞ (0‚Äì1)</label>
                <input type="number" id="batch-threshold" min="0" max="1" step="0.01" value="0.7">
              </div>
            </div>

            <div class="checkbox-row">
              <label>
                <input type="checkbox" id="batch-save-history" checked>
                –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –∏—Å—Ç–æ—Ä–∏—é –∞–Ω–∞–ª–∏–∑–æ–≤
              </label>
              <label>
                <input type="checkbox" id="batch-generate-report" checked>
                –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–¥–Ω—ã–π –æ—Ç—á—ë—Ç
              </label>
            </div>

            <div style="margin-top:14px;">
              <button class="btn-primary" id="batch-start-btn">
                ‚ñ∂ –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞–∫–µ—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑
              </button>
              <button class="btn-ghost" id="batch-reset-btn">
                –°–±—Ä–æ—Å–∏—Ç—å —Ñ–æ—Ä–º—É
              </button>
            </div>

            <div style="margin-top:14px;">
              <label>–°—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</label>
              <div class="progress-bar">
                <div class="progress-bar-inner" id="batch-progress-bar"></div>
              </div>
              <div class="muted" id="batch-progress-text" style="margin-top:4px;">
                –ê–Ω–∞–ª–∏–∑ –µ—â—ë –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª—Å—è.
              </div>
            </div>
          </div>

          <!-- RIGHT: SUMMARY -->
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">–°–≤–æ–¥–∫–∞ –ø–æ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –∞–Ω–∞–ª–∏–∑—É</div>
                <div class="card-subtitle">–ö—Ä–∞—Ç–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–∞–∫–µ—Ç–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏</div>
              </div>
            </div>

            <div class="results-block" id="batch-summary">
              <div class="muted">
                –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–∞–∫–µ—Ç–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∑–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –∫—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞:
                –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —É—Ä–æ–≤–Ω—è–º —Ä–∏—Å–∫–∞ –∏ —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á—ë—Ç.
              </div>
            </div>

            <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;">
              <button class="btn-secondary" id="batch-open-report-btn" disabled>
                üìÑ –û—Ç–∫—Ä—ã—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á—ë—Ç
              </button>
              <button class="btn-ghost" id="batch-go-history-btn">
                –ü–µ—Ä–µ–π—Ç–∏ –∫ –∏—Å—Ç–æ—Ä–∏–∏ –∞–Ω–∞–ª–∏–∑–æ–≤
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- SECTION: HISTORY -->
      <section id="section-history" class="section">
        <h1 class="section-title">–ò—Å—Ç–æ—Ä–∏—è –∞–Ω–∞–ª–∏–∑–æ–≤ –∏ –æ—Ç—á—ë—Ç—ã</h1>
        <p class="section-subtitle">
          –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞–Ω–µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∞–Ω–∞–ª–∏–∑–æ–≤, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∞—Ç–µ, —Ç–∏–ø—É –∞–Ω–∞–ª–∏–∑–∞ –∏ –º–æ–¥–µ–ª–∏.
        </p>

        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">–§–∏–ª—å—Ç—Ä—ã</div>
              <div class="card-subtitle">–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω—É–∂–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞</div>
            </div>
          </div>

          <div class="filters-row">
            <div>
              <label for="history-from">–î–∞—Ç–∞ –æ—Ç</label>
              <input type="text" id="history-from" placeholder="–Ω–∞–ø—Ä. 01.03.2025">
            </div>
            <div>
              <label for="history-to">–î–∞—Ç–∞ –¥–æ</label>
              <input type="text" id="history-to" placeholder="–Ω–∞–ø—Ä. 31.03.2025">
            </div>
            <div>
              <label for="history-type">–¢–∏–ø –∞–Ω–∞–ª–∏–∑–∞</label>
              <select id="history-type">
                <option value="">–í—Å–µ</option>
                <option value="single">–ë—ã—Å—Ç—Ä—ã–π –∞–Ω–∞–ª–∏–∑</option>
                <option value="batch">–ü–∞–∫–µ—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑</option>
              </select>
            </div>
            <div>
              <label for="history-model">–ú–æ–¥–µ–ª—å</label>
              <select id="history-model">
                <option value="">–í—Å–µ</option>
                <option value="ml">–ë–∞–∑–æ–≤–∞—è ML-–º–æ–¥–µ–ª—å</option>
                <option value="dl">DL-–º–æ–¥–µ–ª—å</option>
              </select>
            </div>
            <div>
              <button class="btn-secondary" id="history-apply-filters-btn">
                –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä
              </button>
            </div>
          </div>

          <div style="margin-top:10px; overflow-x:auto;">
            <table id="history-table">
              <thead>
              <tr>
                <th>‚Ññ</th>
                <th>–î–∞—Ç–∞/–≤—Ä–µ–º—è</th>
                <th>–¢–∏–ø –∞–Ω–∞–ª–∏–∑–∞</th>
                <th>–ú–æ–¥–µ–ª—å</th>
                <th>–°–æ–æ–±—â–µ–Ω–∏–π</th>
                <th>–î–æ–ª—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã—Ö</th>
              </tr>
              </thead>
              <tbody>
              <!-- –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏; –≤ —Ä–µ–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å backend -->
              </tbody>
            </table>
          </div>

          <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;">
            <button class="btn-primary" id="history-open-report-btn" disabled>
              üìÑ –û—Ç–∫—Ä—ã—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á—ë—Ç
            </button>
            <button class="btn-ghost" id="history-export-btn">
              ‚¨á –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –≤ CSV
            </button>
          </div>
        </div>

        <div style="height:14px;"></div>

        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">–ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –∞–Ω–∞–ª–∏–∑–µ</div>
              <div class="card-subtitle">–°–≤–æ–¥–∫–∞ –ø–æ –∑–∞–ø—É—Å–∫—É –∏ –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ –æ—Ç—á—ë—Ç—É</div>
            </div>
          </div>

          <div class="results-block" id="history-details">
            <div class="muted">
              –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–æ–∫—É –≤ —Ç–∞–±–ª–∏—Ü–µ –≤—ã—à–µ, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∫—Ä–∞—Ç–∫—É—é —Å–≤–æ–¥–∫—É –∏ –¥–µ–π—Å—Ç–≤–∏—è.
            </div>
          </div>
        </div>
      </section>

      <!-- SECTION: TRAIN -->
      <section id="section-train" class="section">
        <h1 class="section-title">–û–±—É—á–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏</h1>


        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏</div>
              <div class="card-subtitle">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–≤–æ–π CSV —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏ —Ç–µ–∫—Å—Ç–∞ –∏ –º–µ—Ç–∫–∏ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏ (text + toxic)</div>
            </div>
          </div>

          <div>
            <label for="train-file">–î–∞—Ç–∞—Å–µ—Ç (CSV, –∫–æ–ª–æ–Ω–∫–∏ text + toxic)</label>
            <input type="file" id="train-file" accept=".csv">
            <p class="field-hint">
              –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏: <code>text</code> (–∏–ª–∏ comment/comment_text) –∏ <code>toxic</code>/<code>label</code> (0/1).
              –ú–æ–¥–µ–ª—å –æ–±—É—á–∞–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ (TF-IDF + LogisticRegression) –∏ –∑–∞–º–µ–Ω—è–µ—Ç —Ç–µ–∫—É—â—É—é.
            </p>
          </div>

          <div style="margin-top:12px;">
            <button class="btn-primary" id="train-start-btn">
              ‚ñ∂ –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ
            </button>
            <button class="btn-ghost" id="train-reset-btn">
              –°–±—Ä–æ—Å–∏—Ç—å —Ñ–æ—Ä–º—É
            </button>
          </div>

          <div style="margin-top:12px;" id="train-status" class="muted">
            –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –æ–±—É—á–µ–Ω–∏–µ. –ü—Ä–æ–≥—Ä–µ—Å—Å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∑–¥–µ—Å—å.
          </div>
        </div>

        <div style="height:14px;"></div>

      </section>

    </div>
  </main>

  <footer>
    –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π.
  </footer>
</div>

<script>
  // =========================
  // –ù–ê–í–ò–ì–ê–¶–ò–Ø –ú–ï–ñ–î–£ –≠–ö–†–ê–ù–ê–ú–ò
  // =========================
  const navButtons = document.querySelectorAll('.nav-btn');
  const sections = {
    quick: document.getElementById('section-quick'),
    batch: document.getElementById('section-batch'),
    history: document.getElementById('section-history'),
    train: document.getElementById('section-train')
  };

  navButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const target = btn.getAttribute('data-section');
      navButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      Object.values(sections).forEach(sec => sec.classList.remove('active'));
      if (sections[target]) {
        sections[target].classList.add('active');
      }
    });
  });

  // =========================
  // –î–ï–ú–û-–õ–û–ì–ò–ö–ê –ë–´–°–¢–†–û–ì–û –ê–ù–ê–õ–ò–ó–ê
  // (–∏–º–∏—Ç–∞—Ü–∏—è, –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω–æ–≥–æ backend)
  // =========================
  const quickAnalyzeBtn = document.getElementById('quick-analyze-btn');
  const quickClearBtn = document.getElementById('quick-clear-btn');
  const quickTextEl = document.getElementById('quick-text');
  const quickModelEl = document.getElementById('quick-model');
  const quickThresholdEl = document.getElementById('quick-threshold');
  const quickResultsEl = document.getElementById('quick-results');
  const quickSaveHistoryBtn = document.getElementById('quick-save-history-btn');
  let lastQuickText = '';
  let lastQuickThreshold = 0.7;

  quickAnalyzeBtn.addEventListener('click', async () => {
  const text = quickTextEl.value.trim();
  if (!text) {
    quickResultsEl.innerHTML = '<span class="muted">–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.</span>';
    quickSaveHistoryBtn.disabled = true;
    return;
  }

  const model = quickModelEl.value; // —Å–µ–π—á–∞—Å backend –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ ML, –Ω–æ –ø–æ–ª–µ –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å
  const threshold = parseFloat(quickThresholdEl.value) || 0.7;
  lastQuickText = text;
  lastQuickThreshold = threshold;

  quickResultsEl.innerHTML = '<span class="muted">–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–Ω–∞–ª–∏–∑...</span>';
  quickSaveHistoryBtn.disabled = true;

  try {
    const resp = await fetch('/api/predict', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ text, threshold }) // model –º–æ–∂–Ω–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å, —Å–µ—Ä–≤–∏—Å —Å–µ–π—á–∞—Å –≤—Å–µ–≥–¥–∞ "ml"
    });

    if (!resp.ok) {
      const errText = await resp.text();
      quickResultsEl.innerHTML = `<span class="muted">–û—à–∏–±–∫–∞ API: ${resp.status} ${resp.statusText}</span>`;
      console.error('API error:', errText);
      return;
    }

    const data = await resp.json();
    console.log('API response:', data);

    const score = data.conflict_score ?? 0;
    const riskLevel = data.risk_level || 'low';
    const labels = data.labels || {};
    const usedModel = data.model || 'ml';
    const usedThreshold = data.threshold ?? threshold;

    let riskLabelRu = '–ù–∏–∑–∫–∏–π —Ä–∏—Å–∫';
    let pillClass = 'pill-risk-low';
    if (riskLevel === 'medium') {
      riskLabelRu = '–°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫';
      pillClass = 'pill-risk-medium';
    } else if (riskLevel === 'high') {
      riskLabelRu = '–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫';
      pillClass = 'pill-risk-high';
    }

    // –∞–∫–∫—É—Ä–∞—Ç–Ω–æ –¥–æ—Å—Ç–∞—ë–º –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –ø–æ –æ—Å–Ω–æ–≤–Ω—ã–º –º–µ—Ç–∫–∞–º
    const toxic = (labels.toxic ?? 0).toFixed(3);
    const insult = (labels.insult ?? 0).toFixed(3);
    const threat = (labels.threat ?? 0).toFixed(3);
    const obscene = (labels.obscene ?? 0).toFixed(3);
    const hate = (labels.identity_hate ?? 0).toFixed(3);
    const severe = (labels.severe_toxic ?? 0).toFixed(3);

    const modelLabel = usedModel === 'ml'
      ? '–ë–∞–∑–æ–≤–∞—è ML-–º–æ–¥–µ–ª—å (TF-IDF + LogisticRegression)'
      : 'DL-–º–æ–¥–µ–ª—å (–ø—Ä–æ—Ç–æ—Ç–∏–ø)';

    quickResultsEl.innerHTML = `
      <div class="results-header">
        <div>
          <strong>–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏:</strong>
          <span style="font-weight:600;">${score.toFixed(3)}</span>
          <span class="pill ${pillClass}">${riskLabelRu}</span>
        </div>
        <span class="pill pill-model">${modelLabel}</span>
      </div>
      <div style="margin-bottom:8px;">
        <span class="muted">–ü–æ—Ä–æ–≥ —Ä–∏—Å–∫–∞: ${Number(usedThreshold).toFixed(2)}</span>
      </div>
      <div style="margin-bottom:8px;">
        <strong>–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ —Ç–∏–ø–∞–º —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏:</strong><br>
        ‚Ä¢ –û–±—â–∞—è —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å (toxic): ${toxic}<br>
        ‚Ä¢ –°–∏–ª—å–Ω–∞—è —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å (severe_toxic): ${severe}<br>
        ‚Ä¢ –û—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è (insult): ${insult}<br>
        ‚Ä¢ –ù–µ–Ω–æ—Ä–º–∞—Ç–∏–≤–Ω–∞—è –ª–µ–∫—Å–∏–∫–∞ (obscene): ${obscene}<br>
        ‚Ä¢ –£–≥—Ä–æ–∑—ã (threat): ${threat}<br>
        ‚Ä¢ –ù–µ–Ω–∞–≤–∏—Å—Ç–Ω–∏—á–µ—Å–∫–∏–µ –≤—ã—Å–∫–∞–∑—ã–≤–∞–Ω–∏—è (identity_hate): ${hate}
      </div>
      <div class="muted">
        –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è: –ø—Ä–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –ø–æ—Ä–æ–≥–µ —Ä–∏—Å–∫ —Å–∏—Ç—É–∞—Ü–∏–∏ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è –∫–∞–∫ ¬´${riskLabelRu.toLowerCase()}¬ª.
        –ó–Ω–∞—á–µ–Ω–∏—è —Ä–∞—Å—Å—á–∏—Ç–∞–Ω—ã –æ–±—É—á–µ–Ω–Ω–æ–π baseline-–º–æ–¥–µ–ª—å—é –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω—ã—Ö –¥–∞—Ç–∞—Å–µ—Ç–æ–≤.
      </div>
    `;

    quickSaveHistoryBtn.disabled = false;
  } catch (err) {
    console.error(err);
    quickResultsEl.innerHTML = '<span class="muted">–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ API. ' +
      '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–ø—É—â–µ–Ω –ª–∏ backend (Flask-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ).</span>';
    quickSaveHistoryBtn.disabled = true;
  }
});

  quickClearBtn.addEventListener('click', () => {
    quickTextEl.value = '';
    quickResultsEl.innerHTML = '<div class="muted">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∫–∞ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã. ' +
      '–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–ª–µ–≤–∞ –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ¬ª.</div>';
    quickSaveHistoryBtn.disabled = true;
    lastQuickText = '';
    lastQuickThreshold = 0.7;
  });

  quickSaveHistoryBtn.addEventListener('click', async () => {
    if (!lastQuickText) {
      quickResultsEl.innerHTML += '<div class="muted" style="margin-top:6px;">–ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.</div>';
      return;
    }
    quickSaveHistoryBtn.disabled = true;
    try {
      const resp = await fetch('/api/save_quick', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ text: lastQuickText, threshold: lastQuickThreshold }),
      });
      if (!resp.ok) {
        const errText = await resp.text();
        quickResultsEl.innerHTML += `<div class="muted" style="margin-top:6px;">–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ${errText}</div>`;
        quickSaveHistoryBtn.disabled = false;
        return;
      }
      const data = await resp.json();
      quickResultsEl.innerHTML += '<div class="muted" style="margin-top:6px;">–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ –∏—Å—Ç–æ—Ä–∏—é.</div>';
      loadHistory();
    } catch (err) {
      console.error(err);
      quickResultsEl.innerHTML += '<div class="muted" style="margin-top:6px;">–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∏—Å—Ç–æ—Ä–∏—é.</div>';
      quickSaveHistoryBtn.disabled = false;
    }
  });

  // =========================
  // –õ–û–ì–ò–ö–ê –ü–ê–ö–ï–¢–ù–û–ì–û –ê–ù–ê–õ–ò–ó–ê
  // =========================
  const batchStartBtn = document.getElementById('batch-start-btn');
  const batchResetBtn = document.getElementById('batch-reset-btn');
  const batchProgressBar = document.getElementById('batch-progress-bar');
  const batchProgressText = document.getElementById('batch-progress-text');
  const batchSummaryEl = document.getElementById('batch-summary');
  const batchOpenReportBtn = document.getElementById('batch-open-report-btn');
  const batchGoHistoryBtn = document.getElementById('batch-go-history-btn');
  const batchFileInput = document.getElementById('batch-file');
  const batchThresholdInput = document.getElementById('batch-threshold');
  let lastReportId = null;

  batchStartBtn.addEventListener('click', async () => {
    const file = batchFileInput.files[0];
    if (!file) {
      batchSummaryEl.innerHTML = '<span class="muted">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª (CSV –∏–ª–∏ TXT).</span>';
      return;
    }

    const threshold = parseFloat(batchThresholdInput.value) || 0.7;

    batchOpenReportBtn.disabled = true;
    batchProgressBar.style.width = '0%';
    batchProgressText.textContent = '–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–Ω–∞–ª–∏–∑ –ø–∞–∫–µ—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏–π...';
    batchSummaryEl.innerHTML = '<span class="muted">–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–Ω–∞–ª–∏–∑...</span>';

    const formData = new FormData();
    formData.append('file', file);
    formData.append('threshold', threshold);

    try {
      const resp = await fetch('/api/batch_predict_file', {
        method: 'POST',
        body: formData,
      });

      if (!resp.ok) {
        const errText = await resp.text();
        batchProgressText.textContent = `–û—à–∏–±–∫–∞ API: ${resp.status}`;
        batchSummaryEl.innerHTML = `<span class="muted">–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–∞–∫–µ—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑. ${errText}</span>`;
        batchProgressBar.style.width = '0%';
        return;
      }

      const data = await resp.json();
      const { count, risk_distribution: dist = {}, threshold: usedThreshold, report_id } = data;
      const low = dist.low || 0;
      const medium = dist.medium || 0;
      const high = dist.high || 0;

      batchProgressBar.style.width = '100%';
      batchProgressText.textContent = '–ü–∞–∫–µ—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à—ë–Ω.';
      lastReportId = report_id || null;
      batchOpenReportBtn.disabled = !lastReportId;
      loadHistory();

      batchSummaryEl.innerHTML = `
        <div style="margin-bottom:6px;">
          –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–π: <strong>${count}</strong><br>
          –ü–æ—Ä–æ–≥ —Ä–∏—Å–∫–∞: <strong>${Number(usedThreshold ?? threshold).toFixed(2)}</strong>
        </div>
        <div class="progress-badges">
          <span class="pill pill-risk-low">–ù–∏–∑–∫–∏–π: ${low}</span>
          <span class="pill pill-risk-medium">–°—Ä–µ–¥–Ω–∏–π: ${medium}</span>
          <span class="pill pill-risk-high">–í—ã—Å–æ–∫–∏–π: ${high}</span>
        </div>
        <div style="margin-top:8px;" class="muted">
          –†–∞—Å—á—ë—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –æ–±—É—á–µ–Ω–Ω–æ–π baseline-–º–æ–¥–µ–ª—å—é. –ü–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á—ë—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∫–Ω–æ–ø–∫–µ –Ω–∏–∂–µ.
        </div>
      `;
    } catch (err) {
      console.error(err);
      batchProgressText.textContent = '–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∞–Ω–∞–ª–∏–∑–∞.';
      batchSummaryEl.innerHTML = '<span class="muted">–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ API. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–ø—É—â–µ–Ω –ª–∏ backend.</span>';
      batchProgressBar.style.width = '0%';
    }
  });

  batchResetBtn.addEventListener('click', () => {
    batchProgressBar.style.width = '0%';
    batchProgressText.textContent = '–ê–Ω–∞–ª–∏–∑ –µ—â—ë –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª—Å—è.';
    batchSummaryEl.innerHTML = `
      <div class="muted">
        –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–∞–∫–µ—Ç–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∑–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –∫—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞:
        –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —É—Ä–æ–≤–Ω—è–º —Ä–∏—Å–∫–∞ –∏ —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á—ë—Ç.
      </div>
    `;
    lastReportId = null;
    batchOpenReportBtn.disabled = true;
  });

  batchOpenReportBtn.addEventListener('click', () => {
    if (!lastReportId) return;
    window.open(`/report/${lastReportId}`, '_blank');
  });

  batchGoHistoryBtn.addEventListener('click', () => {
    document.querySelector('.nav-btn[data-section="history"]').click();
  });

  // =========================
  // –ò–°–¢–û–†–ò–Ø
  // =========================
  const historyTableBody = document.querySelector('#history-table tbody');
  const historyDetailsEl = document.getElementById('history-details');
  const historyOpenReportBtn = document.getElementById('history-open-report-btn');
  let selectedHistoryId = null;

  async function loadHistory() {
    try {
      const resp = await fetch('/api/reports');
      if (!resp.ok) {
        historyTableBody.innerHTML = '<tr><td colspan="6">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é.</td></tr>';
        return;
      }
      const data = await resp.json();
      const reports = data.reports || [];

      if (!reports.length) {
        historyTableBody.innerHTML = '<tr><td colspan="6">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–∞–∫–µ—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑.</td></tr>';
        return;
      }

      historyTableBody.innerHTML = '';
      reports.forEach((row, idx) => {
        const dist = row.risk_distribution || {};
        const total = row.count || 0;
        const high = dist.high || 0;
        const conflictShare = total ? `${((high / total) * 100).toFixed(1)} %` : '‚Äî';
        const tr = document.createElement('tr');
        tr.dataset.id = String(row.id);
        const typeLabel = row.type === 'quick' ? '–ë—ã—Å—Ç—Ä—ã–π –∞–Ω–∞–ª–∏–∑' : '–ü–∞–∫–µ—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑';
        tr.innerHTML = `
          <td>${idx + 1}</td>
          <td>${row.created_at || ''}</td>
          <td>${typeLabel}</td>
          <td>–ë–∞–∑–æ–≤–∞—è ML</td>
          <td>${row.count || 0}</td>
          <td>${conflictShare}</td>
        `;
        historyTableBody.appendChild(tr);
      });
    } catch (err) {
      console.error(err);
      historyTableBody.innerHTML = '<tr><td colspan="6">–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏—Å—Ç–æ—Ä–∏–∏.</td></tr>';
    }
  }

  loadHistory();

  historyTableBody.addEventListener('click', (e) => {
    const tr = e.target.closest('tr');
    if (!tr) return;
    const id = tr.dataset.id;
    selectedHistoryId = id;
    historyOpenReportBtn.disabled = !id;

    [...historyTableBody.querySelectorAll('tr')].forEach(r => r.style.background = '');
    tr.style.background = '#f1f3ff';

    const typeCell = tr.children[2]?.textContent || '–ê–Ω–∞–ª–∏–∑';
    historyDetailsEl.innerHTML = `
      <div><strong>–í—ã–±—Ä–∞–Ω –æ—Ç—á—ë—Ç ${id}</strong></div>
      <div style="margin-top:6px;" class="muted">
        –¢–∏–ø: ${typeCell}. –ù–∞–∂–º–∏—Ç–µ ¬´–û—Ç–∫—Ä—ã—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á—ë—Ç¬ª, —á—Ç–æ–±—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª–∏.
      </div>
    `;
  });

  historyOpenReportBtn.addEventListener('click', () => {
    if (!selectedHistoryId) return;
    window.open(`/report/${selectedHistoryId}`, '_blank');
  });

  // =========================
  // –û–ë–£–ß–ï–ù–ò–ï
  // =========================
  const trainFileInput = document.getElementById('train-file');
  const trainStartBtn = document.getElementById('train-start-btn');
  const trainResetBtn = document.getElementById('train-reset-btn');
  const trainStatusEl = document.getElementById('train-status');

  trainStartBtn.addEventListener('click', async () => {
    const file = trainFileInput.files[0];
    if (!file) {
      trainStatusEl.innerHTML = '–í—ã–±–µ—Ä–∏—Ç–µ CSV-—Ñ–∞–π–ª —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏ text –∏ toxic (0/1).';
      return;
    }

    trainStartBtn.disabled = true;
    trainResetBtn.disabled = true;
    trainStatusEl.innerHTML = '–ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞—Ç–∞—Å–µ—Ç –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –æ–±—É—á–µ–Ω–∏–µ...';

    const formData = new FormData();
    formData.append('file', file);

    try {
      const resp = await fetch('/api/train_model', {
        method: 'POST',
        body: formData,
      });

      if (!resp.ok) {
        const errText = await resp.text();
        trainStatusEl.innerHTML = `–û—à–∏–±–∫–∞ –æ–±—É—á–µ–Ω–∏—è: ${resp.status} ${errText}`;
        trainStartBtn.disabled = false;
        trainResetBtn.disabled = false;
        return;
      }

      const data = await resp.json();
      trainStatusEl.innerHTML = `
        <div><strong>–û–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ.</strong></div>
        <div>–°—Ç—Ä–æ–∫ –≤ –¥–∞—Ç–∞—Å–µ—Ç–µ: ${data.trained_on}</div>
        <div>–¢–µ–∫—Å—Ç–æ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: ${data.text_column}</div>
        <div>–ö–æ–ª–æ–Ω–∫–∞ –º–µ—Ç–∫–∏: ${data.label_column}</div>
        <div class="muted" style="margin-top:6px;">–ú–æ–¥–µ–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –Ω–æ–≤—ã—Ö –ø—Ä–æ–≥–Ω–æ–∑–æ–≤.</div>
      `;

      // –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –æ–±–Ω–æ–≤–∏–º –∏—Å—Ç–æ—Ä–∏—é, —á—Ç–æ–±—ã –æ—Ç–æ–±—Ä–∞–∑–∏–ª–∏—Å—å –Ω–æ–≤—ã–µ –æ—Ç—á—ë—Ç—ã –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–∏—Ö –∞–Ω–∞–ª–∏–∑–∞—Ö
      loadHistory();
    } catch (err) {
      console.error(err);
      trainStatusEl.innerHTML = '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ API –æ–±—É—á–µ–Ω–∏—è.';
    } finally {
      trainStartBtn.disabled = false;
      trainResetBtn.disabled = false;
    }
  });

  trainResetBtn.addEventListener('click', () => {
    trainFileInput.value = '';
    trainStatusEl.innerHTML = '–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –æ–±—É—á–µ–Ω–∏–µ. –ü—Ä–æ–≥—Ä–µ—Å—Å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∑–¥–µ—Å—å.';
  });

  // –§–∏–ª—å—Ç—Ä—ã –≤ –∏—Å—Ç–æ—Ä–∏–∏ —Å–µ–π—á–∞—Å –Ω–µ –º–µ–Ω—è—é—Ç –¥–∞–Ω–Ω—ã–µ ‚Äî –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ UI-–º–∞–∫–µ—Ç.
</script>
</body>
</html>
